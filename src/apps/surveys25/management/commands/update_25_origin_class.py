from django.core.management.base import BaseCommand
from django.db import transaction
from apps.surveys25.models import Survey

# ----------------------- 對應表 -----------------------
MAPPING = {
    "100070704790": 1,
    "100070942142": 32,
    "100071017400": 31,
    "100072046970": 50,
    "100090112650": 25,
    "100090140230": 32,
    "100091149310": 4,
    "100091551740": 3,
    "100091618390": 9,
    "100140565822": 33,
    "100200200523": 30,
    "660190044440": 41,
    "660200043961": 31,
    "670290054070": 169,
    "660260004320": 1,
    "100080311830": 1,
    "640310002550": 1,
    "640210013432": 1,
    "640310008263": 1,
    "640310006783": 1,
    "660190015640": 1,
    "670010010560": 1,
    "670040014630": 1,
    "670020010630": 1,
    "670030006820": 1,
    "670050004330": 1,
    "100130502250": 1,
    "100130501300": 1,
    "100080107551": 101,
    "640240010970": 101,
    "640150006740": 1,
    "640350007892": 1,
    "640350015535": 101,
    "640240005990": 1,
    "660080004850": 1,
    "660150006070": 1,
    "660150001720": 1,
    "660150016200": 1,
    "670040004101": 1,
    "640320009844": 101,
    "640300014760": 1,
    "640240007521": 1,
    "640300006980": 1,
    "640300007810": 1,
    "100100216590": 1,
    "100100809410": 1,
    "100101410250": 101,
    "100100216430": 1,
    "100101409432": 1,
    "100101404830": 1,
    "100101405771": 1,
    "100101402480": 1,
    "100132112570": 1,
    "100132110190": 1,
    "100132112180": 1,
    "100131712173": 1,
    "100132005470": 1,
    "100131602810": 1,
    "100132013910": 1,
    "100101309380": 1,
    "100101307990": 1,
    "100101308380": 1,
    "100101312070": 1,
    "100101209860": 1,
    "670290006230": 1,
    "670290013640": 1,
    "670250014470": 1,
    "670290015850": 1,
    "670220015180": 1,
    "660080010580": 1,
    "660080010550": 1,
    "660270014220": 1,
    "660270007430": 1,
    "100051800680": 1,
    "100051803930": 1,
    "100051614552": 1,
    "100072506270": 101,
    "100072504860": 1,
    "100072203550": 1,
    "100080300630": 1,
    "100071407840": 1,
    "100071313110": 101,
    "660090002520": 1,
    "660090001500": 1,
    "100072013980": 1,
    "100071603590": 1,
    "100071612650": 1,
    "100081011430": 1,
    "100071914254": 1,
    "100072311170": 1,
    "100071611080": 101,
    "100071601950": 1,
    "100071607150": 101,
    "100071615840": 1,
    "100020512360": 1,
    "100020703641": 101,
    "100130912380": 1,
    "100131102570": 1,
    "100130913330": 1,
    "100130912250": 1,
    "100131707901": 1,
    "100130507060": 101,
    "100131211940": 1,
    "100131414450": 1,
    "100130503472": 1,
    "100131315790": 1,
    "100131204973": 101,
    "680020016120": 1,
    "100050301100": 1,
    "100051301690": 1,
    "100050804270": 1,
    "680060002080": 1,
    "680050009520": 1,
    "100020708271": 101,
    "100020712730": 1,
    "100020803290": 101,
    "100021015910": 1,
    "650030007970": 1,
    "640210007190": 101,
    "100071302590": 1,
    "680060008760": 1,
    "650230004960": 1,
    "650150001630": 1,
    "650100012042": 1,
    "650010010430": 1,
    "630110011790": 1,
    "650230006800": 1,
    "630010008400": 1,
    "650230002785": 1,
    "650230010743": 1,
    "650230003220": 1,
    "680110001640": 1,
    "680090003410": 1,
    "680110013520": 1,
    "680090000080": 1,
    "100040306464": 1,
    "100041112720": 1,
    "100040713270": 1,
    "680110015860": 101,
    "100091202460": 1,
    "100091213300": 1,
    "100091204160": 1,
    "100091207873": 101,
    "100091215440": 1,
    "100091200830": 1,
    "100091214090": 1,
    "100091203340": 1,
    "100091200650": 1,
    "100091210700": 1,
    "100090314300": 1,
    "650230004620": 1,
    "650220006430": 1,
    "100090308490": 101,
    "100090508070": 1,
    "100091805191": 1,
    "100150201680": 1,
    "100150210450": 101,
    "100150300420": 1,
    "100150305640": 1,
    "100150306971": 1,
    "100072312600": 1,
    "100072007881": 1,
    "660190012666": 101,
    "100131208830": 1,
    "100130906321": 1,
    "100080700930": 1,
    "100080415800": 1,
    "100080708450": 1,
    "100080608410": 1,
    "100080406370": 1,
    "100081209700": 1,
    "100080402180": 1,
    "100080805650": 1,
    "100080909930": 1,
    "100080815470": 1,
    "100140111390": 101,
    "100140403010": 1,
    "100140400600": 1,
    "100140114653": 1,
    "100140910350": 1,
    "100150915200": 1,
    "100150705720": 1,
    "100151203082": 1,
    "100150416380": 1,
    "100150506210": 101,
    "100150601830": 1,
    "100151010962": 1,
    "100150612460": 1,
}
# ------------------------------------------------------

class Command(BaseCommand):
    help = "批次更新 Survey.origin_class（readonly=False, page=1）"

    def handle(self, *args, **kwargs):
        surveys = list(
            Survey.objects.filter(
                readonly=False,
                page=1,
                farmer_id__in=MAPPING.keys()
            )
        )

        for survey in surveys:
            survey.origin_class = MAPPING[survey.farmer_id]

        with transaction.atomic():
            Survey.objects.bulk_update(surveys, ["origin_class"])

        self.stdout.write(
            self.style.SUCCESS(f"✅ 已更新 {len(surveys)} 筆 Survey.origin_class")
        )
